{% extends "layout.html" %}
{% block content %}
<h2>Recordings</h2>

<details open>
  <summary>Record New</summary>
  <div style="display:flex; gap:.5rem; align-items:center; flex-wrap:wrap; margin-bottom:.5rem;">
    <input type="text" id="rec-name" value="Meeting Reminder" style="margin:0; width:auto;">
    <button id="btn-record" style="margin:0; white-space:nowrap;"><i data-lucide="mic"></i> Start Recording</button>
    <span id="rec-timer" style="font-size:.85rem; font-variant-numeric:tabular-nums; opacity:.6; display:none;">0:00</span>
    <button id="btn-save" disabled style="display:none; margin:0; white-space:nowrap;"><i data-lucide="save"></i> Save Recording</button>
    <button id="btn-cancel" class="outline secondary" style="display:none; margin:0; white-space:nowrap;"><i data-lucide="x"></i> Cancel</button>
  </div>
  <div id="preview" style="margin-top:.5rem;"></div>
  <p id="rec-status" style="font-size:.85em; opacity:.7;"></p>
</details>

{% if recordings %}
<div style="display:flex; flex-direction:column; gap:.75rem;">
  {% for r in recordings %}
  <div style="display:flex; align-items:center; gap:1rem; padding:.75rem 1rem; border-radius:6px; background:rgba(255,255,255,.03); border:1px solid rgba(255,255,255,.06); flex-wrap:wrap;">
    <div style="flex:1; min-width:120px;">
      <strong>{{ r.name }}</strong>
      <div style="font-size:.8em; opacity:.5;">{{ r.created_at.strftime('%b %d, %Y') }}</div>
    </div>
    <div class="audio-player">
      <button class="ap-btn ap-play" type="button"><i data-lucide="play"></i></button>
      <span class="ap-time ap-cur">0:00</span>
      <div class="ap-track"><div class="ap-progress"></div></div>
      <span class="ap-time ap-dur">0:00</span>
      <audio src="/uploads/{{ r.filename }}" preload="none"></audio>
    </div>
    <form method="post" action="/recordings/{{ r.id }}/delete" onsubmit="return confirm('Delete?')" style="margin:0;">
      <button type="submit" class="outline secondary btn-del" style="margin:0;"><i data-lucide="trash-2"></i></button>
    </form>
  </div>
  {% endfor %}
</div>
{% else %}
<p style="opacity:.5;">No recordings yet. Record one above.</p>
{% endif %}

<script src="/static/recorder.js"></script>
<script>
document.querySelectorAll('.audio-player').forEach(p => initPlayer(p));
</script>
{% endblock %}
